"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_uiUtil=require("@ctmobile/ui-util"),selectorPrefix="ct-split",edgeStep=5,minWidth=30,minHeight=30;function initVar(){var t=this.config,i=t.minBlankWidth,e=void 0===i?minWidth:i,o=t.minBlankHeight,s=void 0===o?minHeight:o;this.disable=!1,this.isCanResize=!1,this.isDown=!1,this.isMove=!1,this.baseX=null,this.baseY=null,this.moveValue=null,this.baseWidth=this.el.offsetWidth,this.baseHeight=this.el.offsetHeight,this.leftCritical=-this.baseWidth+e,this.rightCritical=this.baseWidth-e,this.topCritical=-this.baseHeight+s,this.bottomCritical=this.baseHeight-s,this.direction=null;var n=Array.from(this.el.children);this.mainEl=find(n,"".concat(selectorPrefix,"-main")),this.leftEl=find(n,"".concat(selectorPrefix,"-left")),this.rightEl=find(n,"".concat(selectorPrefix,"-right")),this.topEl=find(n,"".concat(selectorPrefix,"-top")),this.bottomEl=find(n,"".concat(selectorPrefix,"-bottom"))}function initDirection(){var t=this.config.direction;"vertical"===(void 0===t?"horizontal":t)&&(this.el.style.flexDirection="column")}function find(){for(var t,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=1<arguments.length?arguments[1]:void 0,o=0;o<i.length;o++)if(i[o].classList.contains(e)){t=i[o];break}return t}function initOrder(){var t=0,i=this.config.direction,e=void 0===i?"horizontal":i;"horizontal"===e?(this.leftEl&&(this.leftEl.style.order=t++),this.mainEl&&(this.mainEl.style.order=t++),this.rightEl&&(this.rightEl.style.order=t++)):"vertical"===e&&(this.topEl&&(this.topEl.style.order=t++),this.mainEl&&(this.mainEl.style.order=t++),this.bottomEl&&(this.bottomEl.style.order=t++))}function initDimension(){this.clientX=this.mainEl.offsetLeft,this.clientY=this.mainEl.offsetTop,this.mainWith=this.mainEl.offsetWidth,this.mainHeight=this.mainEl.offsetHeight,this.leftEl&&(this.leftWidth=this.leftEl.offsetWidth,this.leftHeight=this.leftEl.offsetHeight),this.rightEl&&(this.rightWidth=this.rightEl.offsetWidth,this.rightHeight=this.rightEl.offsetHeight),this.topEl&&(this.topWidth=this.topEl.offsetWidth,this.topHeight=this.topEl.offsetHeight),this.bottomEl&&(this.bottomWidth=this.bottomEl.offsetWidth,this.bottomHeight=this.bottomEl.offsetHeight)}function initEvents(){this.mainEl.addEventListener("mousedown",this.onMainMouseDown),this.mainEl.addEventListener("mousemove",this.onMainMouseMove),this.mainEl.addEventListener("mouseleave",this.onMainMouseLeave),this.el.addEventListener("mousemove",this.onElMouseMove),this.el.addEventListener("mouseup",this.onElMouseUp)}function createSeparator(){var t=this.config.direction,i=void 0===t?"horizontal":t;this.separatorEl=_uiUtil.Dom6.createElement('<div class="'.concat(selectorPrefix,"-separator ").concat(i,'"></div>')),this.mainEl.appendChild(this.separatorEl)}function reset(){var t=this.config,i=t.minBlankWidth,e=void 0===i?minWidth:i,o=t.minBlankHeight,s=void 0===o?minHeight:o;this.isDown&&this.isCanResize&&!this.ismove?this.isCanResize=!0:(this.isCanResize=!1,this.direction=null),this.isDown=!1,this.ismove=!1,this.baseX=null,this.baseY=null,this.moveValue=null,this.baseWidth=this.el.offsetWidth,this.baseHeight=this.el.offsetHeight,this.leftCritical=-this.baseWidth+e,this.rightCritical=this.baseWidth-e,this.topCritical=-this.baseHeight+s,this.bottomCritical=this.baseHeight-s,this.separatorEl.style.display="none",initDimension.call(this)}function getMoveValue(t){var i=t.min,e=t.max,o=t.val,s=this.config,n=s.minBlankWidth,l=void 0===n?minWidth:n,a=s.minBlankHeight,h=void 0===a?minHeight:a,r=this.config.direction,c=void 0===r?"horizontal":r,d=this.direction,f=void 0===d?"":d;return o<=i?i+("left"===f||"top"===f?"horizontal"===c?l:h:0):e<=o?e-("right"===f||"bottom"===f?"horizontal"===c?l:h:0):o}var Split=function(){function e(t,i){(0,_classCallCheck2.default)(this,e),this.el=t,this.config=Object.assign({minBlankWidth:minWidth,minBlankHeight:minHeight},i),this.disable=!1,this.onMainMouseDown=this.onMainMouseDown.bind(this),this.onMainMouseMove=this.onMainMouseMove.bind(this),this.onMainMouseLeave=this.onMainMouseLeave.bind(this),this.onElMouseMove=this.onElMouseMove.bind(this),this.onElMouseUp=this.onElMouseUp.bind(this),initVar.call(this),initDirection.call(this),initOrder.call(this),initEvents.call(this),initDimension.call(this),createSeparator.call(this),this.mainEl.style.minWidth="".concat(this.config.minBlankWidth,"px"),this.mainEl.style.minHeight="".concat(this.config.minBlankHeight,"px")}return(0,_createClass2.default)(e,[{key:"onMainMouseDown",value:function(t){var i=this,e=i.disable;return(void 0===e||!e)&&(!!i.isCanResize&&(console.log("mousedown",i.config.direction),i.isDown=!0,i.baseX=t.clientX,i.baseY=t.clientY,i.separatorEl.style.display="block",void("left"===i.direction?i.separatorEl.style.left="0":"right"===i.direction?i.separatorEl.style.left="".concat(i.mainWith,"px"):"top"===i.direction?i.separatorEl.style.top="0":"bottom"===i.direction&&(i.separatorEl.style.top="".concat(i.mainHeight,"px")))))}},{key:"onMainMouseMove",value:function(t){var i=this,e=i.disable;if(void 0!==e&&e)return!1;var o=i.config,s=o.direction,n=void 0===s?"horizontal":s,l=o.onCanMove;if(i.isCanResize&&i.isDown)return!1;console.log("mainmousemove",n),i.mainRect=i.mainEl.getBoundingClientRect();var a=t.clientX,h=t.clientY;if(a-edgeStep<=i.mainRect.left&&h-edgeStep>i.mainRect.top&&h+edgeStep<i.mainRect.bottom){if("horizontal"===n){if(t.stopPropagation(),!i.leftEl)return!1;i.direction="left",i.isCanResize=!0,document.body.style.cursor="col-resize",l&&l(i.direction),console.log(n,"left")}}else if(a+edgeStep>=i.mainRect.right&&h-edgeStep>i.mainRect.top&&h+edgeStep<i.mainRect.bottom){if("horizontal"===n){if(t.stopPropagation(),!i.rightEl)return!1;i.direction="right",i.isCanResize=!0,document.body.style.cursor="col-resize",l&&l(i.direction),console.log(n,"right")}}else if(h-edgeStep<=i.mainRect.top&&a-edgeStep>i.mainRect.left&&a+edgeStep<i.mainRect.right){if("vertical"===n){if(t.stopPropagation(),!i.topEl)return!1;i.direction="top",i.isCanResize=!0,document.body.style.cursor="row-resize",l&&l(i.direction),console.log(n,"top",document.body.style.cursor)}}else if(h+edgeStep>=i.mainRect.bottom&&a-edgeStep>i.mainRect.left&&a+edgeStep<i.mainRect.right){if("vertical"===n){if(t.stopPropagation(),!i.bottomEl)return!1;i.direction="bottom",i.isCanResize=!0,document.body.style.cursor="row-resize",l&&l(i.direction),console.log(n,"bottom")}}else i.isCanResize=!1,document.body.style.cursor="default",console.log(n,"default",document.body.style.cursor)}},{key:"onMainMouseLeave",value:function(t){var i=this.disable;return(void 0===i||!i)&&((!this.isCanResize||!this.isDown)&&(document.body.style.cursor="default",console.log("mouseleave",document.body.style.cursor),void t.stopPropagation()))}},{key:"onElMouseMove",value:function(t){var i=this,e=i.disable;if(void 0!==e&&e)return!1;if(console.log("elmousemove",i.config.direction),!i.isCanResize||!i.isDown)return!(i.separatorEl.style.display="none");var o=i.config,s=o.direction,n=o.onMove,l=o.minBlankWidth,a=void 0===l?minWidth:l,h=o.minBlankHeight,r=void 0===h?minHeight:h;"horizontal"===s?document.body.style.cursor="col-resize":"vertical"===s&&(document.body.style.cursor="row-resize"),i.isMove=!0;var c,d=t.clientX,f=t.clientY,m=d-i.baseX,u=f-i.baseY;"left"===i.direction?(((c=m)<-i.leftWidth||c>i.mainWith-a)&&(c<-i.leftWidth&&(c=-i.leftWidth),c>i.mainWith-a&&(c=i.mainWith-a)),i.separatorEl.style.left="".concat(c,"px")):"right"===i.direction?(((c=i.mainWith+m)<a||c>i.mainWith+i.rightWidth)&&(c<a&&(c=a),c>i.mainWith+i.rightWidth&&(c=i.mainWith+i.rightWidth)),i.separatorEl.style.left="".concat(c,"px")):"top"===i.direction?(((c=u)<-i.topHeight||c>i.mainHeight-r)&&(c<-i.topHeight&&(c=-i.topHeight),c>i.mainHeight-r&&(c=i.mainHeight-r)),i.separatorEl.style.top="".concat(c,"px")):"bottom"===i.direction&&(((c=i.mainEl.offsetHeight+u)<r||c>i.mainHeight+i.bottomHeight)&&(c<r&&(c=r),c>i.mainHeight+i.bottomHeight&&(c=i.mainHeight+i.bottomHeight)),i.separatorEl.style.top="".concat(c,"px")),i.moveValue=c,n&&n(i.direction,i.moveValue),t.stopPropagation()}},{key:"onElMouseUp",value:function(){var t=this,i=t.disable;if(void 0!==i&&i)return!1;if(!(t.isCanResize&&t.isDown&&t.isMove))return reset.call(t),!1;var e=t.config,o=e.onSuccess,s=e.minBlankWidth,n=void 0===s?minWidth:s,l=e.minBlankHeight,a=void 0===l?minHeight:l;if("left"===t.direction){var h=getMoveValue.call(t,{min:-t.leftEl.offsetWidth,max:t.mainEl.offsetWidth-n,val:t.moveValue});t.leftEl.style.width="".concat(t.leftEl.offsetWidth+h,"px")}else if("right"===t.direction){var r=getMoveValue.call(t,{min:n,max:t.mainEl.offsetWidth+t.rightEl.offsetWidth,val:t.moveValue});t.rightEl.style.width="".concat(t.rightEl.offsetWidth-(r-t.mainEl.offsetWidth),"px")}else if("top"===t.direction){var c=getMoveValue.call(t,{min:-t.topEl.offsetHeight,max:t.mainEl.offsetHeight-a,val:t.moveValue});t.topEl.style.height="".concat(t.topEl.offsetHeight+c,"px")}else if("bottom"===t.direction){var d=getMoveValue.call(t,{min:a,max:t.mainEl.offsetHeight+t.bottomEl.offsetHeight,val:t.moveValue});t.bottomEl.style.height="".concat(t.bottomEl.offsetHeight-(d-t.mainEl.offsetHeight),"px")}reset.call(t),o&&o()}},{key:"setDisable",value:function(t){this.disable=t}}]),e}(),SplitFactory={create:function(t,i){return new Split(t,i)}},_default=SplitFactory;exports.default=_default;
//# sourceMappingURL=split.js.map
