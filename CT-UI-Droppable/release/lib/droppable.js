"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),selectorPrefix="ct-droppable-",scrollStep=5;function initEvents(){var e=this,a=this;initDragSourceEvent.call(a);var t=a.config,l=t.isDragSourceDisplay,u=void 0===l||l,o=t.isDragSourceExist,f=void 0===o||o,d=t.onBoundaryDetection,n=t.infinite,p=void 0!==n&&n;a.el.addEventListener("mousemove",function(e){var t=a.disable;if(void 0!==t&&t)return!1;if(!a.isdown)return!1;a.ismove||(a.ismove=!0,u&&f||(a.sourceEl.style.visibility="hidden"));var l=e.pageX,o=e.pageY,n=l-a.firstX,r=o-a.firstY,s=getMoveInTargetEls.call(a);if(p)if(a.ismovecanput){var i=s.boundaryDetection[0].rect,c={left:!1,right:!1,top:!1,bottom:!1};a.baseX+n<i.left||a.baseX+n+a.cloneEl.offsetWidth>i.right?(a.baseX+n<i.left&&(a.cloneEl.style.left="".concat(i.left,"px"),c.left=!0),a.baseX+n+a.cloneEl.offsetWidth>i.right&&(a.cloneEl.style.top="".concat(i.right-a.cloneEl.offsetWidth,"px"),c.right=!0)):a.cloneEl.style.left="".concat(a.baseX+n,"px"),a.baseY+r<i.top||a.baseY+r+a.cloneEl.offsetHeight>i.bottom?(a.baseY+r<i.top&&(a.cloneEl.style.top="".concat(i.top,"px"),c.top=!0),a.baseY+r+a.cloneEl.offsetHeight>i.bottom&&(a.cloneEl.style.top="".concat(i.bottom-a.cloneEl.offsetHeight,"px"),c.bottom=!0)):a.cloneEl.style.top="".concat(a.baseY+r,"px"),c.left||c.right||c.top||c.bottom?d&&d(c,boundaryDetectionScroll.bind(a)):a.boundaryDetectionHandler&&(cancelAnimationFrame(a.boundaryDetectionHandler),a.boundaryDetectionHandler=null)}else 0<s.complete.length?(a.ismovecanput=!0,a.cloneEl.style.cursor="pointer"):a.cloneEl.style.cursor="not-allowed",a.cloneEl.style.left="".concat(a.baseX+n,"px"),a.cloneEl.style.top="".concat(a.baseY+r,"px");else 0<s.complete.length?a.cloneEl.style.cursor="pointer":a.cloneEl.style.cursor="not-allowed",a.cloneEl.style.left="".concat(a.baseX+n,"px"),a.cloneEl.style.top="".concat(a.baseY+r,"px")}),a.el.addEventListener("mouseleave",function(){if(!a.isdown)return!1;goBack.call(a,e.sourceEl,e.targetEls)})}function initDragSourceEvent(){var i=this,c=this,e=c.config,t=e.dragSourceExtendClasses,a=void 0===t?[]:t,u=e.onDragClone,f=e.onSourceEnter,d=e.onSourceLeave,l=e.inclusionRelation,p=void 0===l||l;c.sourceEventHanlder=new WeakMap;for(var o=function(e){var r=i.sourceEls[e],t={};function o(){var e=r.cloneNode(!0);return a?e.className+=" ".concat(a.join(" ")):e.style.border="1px dashed black",e}function l(e){var t=c.disable;if(void 0!==t&&t)return!1;c.isdown=!0;var l=(c.sourceEl=r).getBoundingClientRect();c.baseX=l.left,c.baseY=l.top,c.firstX=e.pageX,c.firstY=e.pageY,u?(c.cloneEl=u(r),c.cloneEl||(c.cloneEl=o())):c.cloneEl=o(),c.cloneEl.setAttribute("id",""),c.cloneEl.style.minWidth="".concat(r.offsetWidth,"px"),c.cloneEl.style.minHeight="".concat(r.offsetHeight,"px"),c.cloneEl.style.position="fixed",c.cloneEl.style.zIndex="9999",c.cloneEl.style.left="".concat(c.baseX,"px"),c.cloneEl.style.top="".concat(c.baseY,"px"),c.cloneEl.style.margin="0",c.cloneEl.addEventListener("mouseup",function(){if(!c.ismove)return reset.call(c),!1;var e=getMoveInTargetEls.call(c),t=[].concat(e.section,e.complete);if(0<e.complete.length)if(p)Put.call(c,r,e);else{for(var l=e.complete,o=!1,n=0;n<l.length;n++){if(-1===Array.from(l[n].querySelectorAll(".".concat(selectorPrefix,"source"))).findIndex(function(e){return e===r})){o=!0;break}}o?Put.call(c,r,e):goBack.call(c,r,t)}else goBack.call(c,r,t)}),c.el.appendChild(c.cloneEl)}function n(){var e=c.disable;if(void 0!==e&&e)return!1;r.style.cursor="move",f&&f(r)}function s(){var e=c.disable;if(void 0!==e&&e)return!1;r.style.cursor="default",d&&d(r)}r.addEventListener("mousedown",t.mousedown=l),r.addEventListener("mouseenter",t.mouseenter=n),r.addEventListener("mouseleave",t.mouseover=s),c.sourceEventHanlder.set(r,t)},n=0;n<this.sourceEls.length;n++)o(n)}function Put(e,t){var l=this,o=[].concat(t.section,t.complete),n=l.config,r=n.onPutSuccess,s=n.isDragSourceExist,i=void 0===s||s;if(r){var c=l.cloneEl.getBoundingClientRect(),a=e.cloneNode(!0);a.style.visibility="visible",a.style.cursor="default",r({cloneSourceEl:a,sourceEl:e,targetEls:t.complete,rect:{left:c.left,right:c.right,top:c.top,bottom:c.bottom,width:c.width,height:c.height,x:c.x,y:c.y},naturalRelease:{fn:naturalRelease,context:l}})?(i||l.sourceEl&&(l.sourceEl.parentElement.removeChild(l.sourceEl),l.sourceEl=null),reset.call(l,o)):goBack.call(l,e,o)}}function getMoveInTargetEls(){for(var n=[],r=[],s=[],i=this.cloneEl.getBoundingClientRect(),e=this.config.dragTargetExtendClasses,c=void 0===e?[]:e,a=this.targetEls,t=function(e){var t=a[e],l=t.getBoundingClientRect();(i.left>=l.left&&i.left<=l.right||i.right>=l.left&&i.right<=l.right)&&(i.top>=l.top&&i.top<=l.bottom||i.bottom>=l.top&&i.bottom<=l.bottom)?(c?(c.forEach(function(e){e&&t.classList.remove(e)}),t.className+=" ".concat(c.join(" "))):t.style.border="2px dashed black",i.left>=l.left&&i.left<=l.right&&i.right>=l.left&&i.right<=l.right&&i.top>=l.top&&i.top<=l.bottom&&i.bottom>=l.top&&i.bottom<=l.bottom?n.push(t):r.push(t)):c?c.forEach(function(e){e&&t.classList.remove(e)}):t.style.border="0";var o={top:!1,bottom:!1,left:!1,right:!1};i.top<l.top&&(o.top=!0),i.bottom>l.bottom&&(o.bottom=!0),i.left<l.left&&(o.left=!0),i.right>l.right&&(o.right=!0),s.push({el:t,condition:o,rect:l})},l=0;l<a.length;l++)t(l);return{complete:n,section:r,boundaryDetection:s}}function goBack(t,l){var o=this,e=this.config.noDragReturnAnimate;void 0!==e&&e?setTimeout(function(){o.isdown=!1,o.cloneEl.addEventListener("transitionend",function e(){o.cloneEl.removeEventListener("transitionend",e),reset.call(o,l),t.style.visibility="visible"}),o.cloneEl.style.transition="all .25s ease-out",o.cloneEl.style.transform="translateZ(0)";var e=t.getBoundingClientRect();o.cloneEl.style.left="".concat(e.left,"px"),o.cloneEl.style.top="".concat(e.top,"px")},100):(reset.call(o,l),t.style.visibility="visible")}function reset(l){var e=this,t=this.config.dragTargetExtendClasses,o=void 0===t?[]:t;if(e.cloneEl&&e.el.removeChild(e.cloneEl),l&&0<l.length)for(var n=function(t){o?o.forEach(function(e){e&&l[t].classList.remove(e)}):l[t].style.border="0"},r=0;r<l.length;r++)n(r);e.isdown=!1,e.ismove=!1,e.baseX=null,e.baseY=null,e.preX=null,e.preY=null,e.firstX=null,e.firstY=null,e.cloneEl=null,e.sourceEl=null,e.ismovecanput=!1,e.boundaryDetectionHandler&&(cancelAnimationFrame(e.boundaryDetectionHandler),e.boundaryDetectionHandler=null)}function naturalRelease(e,t){var l=this.cloneEl.getBoundingClientRect(),o=l.left,n=l.top,r=e.getBoundingClientRect(),s=o-r.left,i=n-r.top;t.style.position="absolute",t.style.left="".concat(s,"px"),t.style.top="".concat(i,"px"),e.appendChild(t)}function boundaryDetectionScroll(e,t){var l=e.top,o=e.bottom,n=e.left,r=e.right;l&&0!==t.scrollTop&&(t.scrollTop-scrollStep<0?t.scrollTop=0:t.scrollTop-=scrollStep),o&&t.scrollTop!==t.scrollHeight&&(t.scrollTop+scrollStep>t.scrollHeight?t.scrollTop=t.scrollerHeight:t.scrollTop+=scrollStep),n&&0!==t.scrollLeft&&(t.scrollLeft-scrollStep<0?t.scrollLeft=0:t.scrollLeft-=scrollStep),r&&t.scrollLeft!==t.scrollWidth&&(t.scrollLeft+scrollStep>t.scrollWidth?t.scrollLeft=t.scrollWidth:t.scrollLeft+=scrollStep)}var Droppable=function(){function l(e,t){(0,_classCallCheck2.default)(this,l),this.el=e,this.config=Object.assign({},t),this.disable=!1,this.sourceEls=this.el.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),this.isdown=!1,this.ismove=!1,this.baseX=null,this.baseY=null,this.preX=null,this.preY=null,this.firstX=null,this.firstY=null,this.cloneEl=null,this.sourceEl=null,this.ismovecanput=!1,this.boundaryDetectionHandler=null,initEvents.call(this)}return(0,_createClass2.default)(l,[{key:"refresh",value:function(){for(var e=0;e<this.sourceEls.length;e++){var t=this.sourceEls[e],l=this.sourceEventHanlder.get(t);for(var o in l)t.removeEventListener(o,l[o])}this.sourceEls=this.el.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),initDragSourceEvent.call(this)}},{key:"setDisable",value:function(e){this.disable=e}}]),l}(),DroppableFactory={create:function(e,t){return new Droppable(e,t)}},_default=DroppableFactory;exports.default=_default;
//# sourceMappingURL=droppable.js.map
