"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),selectorPrefix="ct-droppable-",scrollStep=5;function initEvents(){var e=this,i=this;initDragSourceEvent.call(i);var t=i.config,l=t.isDragSourceDisplay,a=void 0===l||l,o=t.isDragSourceExist,u=void 0===o||o,f=t.onBoundaryDetection,n=t.infinite,p=void 0!==n&&n;i.el.addEventListener("mousemove",function(e){if(!i.isdown)return!1;i.ismove||(i.ismove=!0,a&&u||(i.sourceEl.style.visibility="hidden"));var t=e.pageX,l=e.pageY,o=t-i.firstX,n=l-i.firstY,s=getMoveInTargetEls.call(i);if(p)if(i.ismovecanput){var r=s.boundaryDetection[0].rect,c={left:!1,right:!1,top:!1,bottom:!1};i.baseX+o<r.left||i.baseX+o+i.cloneEl.offsetWidth>r.right?(i.baseX+o<r.left&&(i.cloneEl.style.left="".concat(r.left,"px"),c.left=!0),i.baseX+o+i.cloneEl.offsetWidth>r.right&&(i.cloneEl.style.top="".concat(r.right-i.cloneEl.offsetWidth,"px"),c.right=!0)):i.cloneEl.style.left="".concat(i.baseX+o,"px"),i.baseY+n<r.top||i.baseY+n+i.cloneEl.offsetHeight>r.bottom?(i.baseY+n<r.top&&(i.cloneEl.style.top="".concat(r.top,"px"),c.top=!0),i.baseY+n+i.cloneEl.offsetHeight>r.bottom&&(i.cloneEl.style.top="".concat(r.bottom-i.cloneEl.offsetHeight,"px"),c.bottom=!0)):i.cloneEl.style.top="".concat(i.baseY+n,"px"),c.left||c.right||c.top||c.bottom?f&&f(c,boundaryDetectionScroll.bind(i)):i.boundaryDetectionHandler&&(cancelAnimationFrame(i.boundaryDetectionHandler),i.boundaryDetectionHandler=null)}else 0<s.complete.length?(i.ismovecanput=!0,console.log("ismovecanput = true"),i.cloneEl.style.cursor="pointer"):i.cloneEl.style.cursor="not-allowed",i.cloneEl.style.left="".concat(i.baseX+o,"px"),i.cloneEl.style.top="".concat(i.baseY+n,"px"),console.log("222");else 0<s.complete.length?i.cloneEl.style.cursor="pointer":i.cloneEl.style.cursor="not-allowed",i.cloneEl.style.left="".concat(i.baseX+o,"px"),i.cloneEl.style.top="".concat(i.baseY+n,"px")}),i.el.addEventListener("mouseleave",function(){if(!i.isdown)return!1;goBack.call(i,e.sourceEl,e.targetEls)})}function initDragSourceEvent(){var c=this,i=this,e=i.config,t=e.dragSourceExtendClasses,a=void 0===t?[]:t,u=e.onDragClone,f=e.onSourceEnter,p=e.onSourceLeave,l=e.inclusionRelation,d=void 0===l||l;i.sourceEventHanlder=new WeakMap;for(var o=function(e){var s=c.sourceEls[e],t={};function l(){var e=s.cloneNode(!0);return a?e.className+=" ".concat(a.join(" ")):e.style.border="1px dashed black",e}function o(e){i.isdown=!0;var t=(i.sourceEl=s).getBoundingClientRect();i.baseX=t.left,i.baseY=t.top,i.firstX=e.pageX,i.firstY=e.pageY,u?(i.cloneEl=u(s),i.cloneEl||(i.cloneEl=l())):i.cloneEl=l(),i.cloneEl.setAttribute("id",""),i.cloneEl.style.minWidth="".concat(s.offsetWidth,"px"),i.cloneEl.style.minHeight="".concat(s.offsetHeight,"px"),i.cloneEl.style.position="fixed",i.cloneEl.style.zIndex="9999",i.cloneEl.style.left="".concat(i.baseX,"px"),i.cloneEl.style.top="".concat(i.baseY,"px"),i.cloneEl.style.margin="0",i.cloneEl.addEventListener("mouseup",function(){if(!i.ismove)return reset.call(i),!1;var e=getMoveInTargetEls.call(i),t=[].concat(e.section,e.complete);if(0<e.complete.length)if(d)Put.call(i,s,e);else{for(var l=e.complete,o=!1,n=0;n<l.length;n++){if(-1===Array.from(l[n].querySelectorAll(".".concat(selectorPrefix,"source"))).findIndex(function(e){return e===s})){o=!0;break}}o?Put.call(i,s,e):goBack.call(i,s,t)}else goBack.call(i,s,t)}),i.el.appendChild(i.cloneEl)}function n(){s.style.cursor="move",f&&f(s)}function r(){s.style.cursor="default",p&&p(s)}s.addEventListener("mousedown",t.mousedown=o),s.addEventListener("mouseenter",t.mouseenter=n),s.addEventListener("mouseleave",t.mouseover=r),i.sourceEventHanlder.set(s,t)},n=0;n<this.sourceEls.length;n++)o(n)}function Put(e,t){var l=this,o=[].concat(t.section,t.complete),n=l.config,s=n.onPutSuccess,r=n.isDragSourceExist,c=void 0===r||r;if(s){var i=l.cloneEl.getBoundingClientRect(),a=e.cloneNode(!0);a.style.visibility="visible",a.style.cursor="default",s({cloneSourceEl:a,sourceEl:e,targetEls:t.complete,rect:{left:i.left,right:i.right,top:i.top,bottom:i.bottom,width:i.width,height:i.height,x:i.x,y:i.y},naturalRelease:{fn:naturalRelease,context:l}})?(c||l.sourceEl&&(l.sourceEl.parentElement.removeChild(l.sourceEl),l.sourceEl=null),reset.call(l,o)):goBack.call(l,e,o)}}function getMoveInTargetEls(){for(var n=[],s=[],r=[],c=this.cloneEl.getBoundingClientRect(),e=this.config.dragTargetExtendClasses,i=void 0===e?[]:e,a=this.targetEls,t=function(e){var t=a[e],l=t.getBoundingClientRect();(c.left>=l.left&&c.left<=l.right||c.right>=l.left&&c.right<=l.right)&&(c.top>=l.top&&c.top<=l.bottom||c.bottom>=l.top&&c.bottom<=l.bottom)?(i?(i.map(function(e){e&&t.classList.remove(e)}),t.className+=" ".concat(i.join(" "))):t.style.border="2px dashed black",c.left>=l.left&&c.left<=l.right&&c.right>=l.left&&c.right<=l.right&&c.top>=l.top&&c.top<=l.bottom&&c.bottom>=l.top&&c.bottom<=l.bottom?n.push(t):s.push(t)):i?i.map(function(e){e&&t.classList.remove(e)}):t.style.border="0";var o={top:!1,bottom:!1,left:!1,right:!1};c.top<l.top&&(o.top=!0),c.bottom>l.bottom&&(o.bottom=!0),c.left<l.left&&(o.left=!0),c.right>l.right&&(o.right=!0),r.push({el:t,condition:o,rect:l})},l=0;l<a.length;l++)t(l);return{complete:n,section:s,boundaryDetection:r}}function goBack(t,l){var o=this,e=this.config.noDragReturnAnimate;void 0!==e&&e?setTimeout(function(){o.isdown=!1,o.cloneEl.addEventListener("transitionend",function e(){o.cloneEl.removeEventListener("transitionend",e),reset.call(o,l),t.style.visibility="visible"}),o.cloneEl.style.transition="all .25s ease-out",o.cloneEl.style.transform="translateZ(0)";var e=t.getBoundingClientRect();o.cloneEl.style.left="".concat(e.left,"px"),o.cloneEl.style.top="".concat(e.top,"px")},100):(reset.call(o,l),t.style.visibility="visible")}function reset(l){var e=this,t=this.config.dragTargetExtendClasses,o=void 0===t?[]:t;if(e.cloneEl&&e.el.removeChild(e.cloneEl),l&&0<l.length)for(var n=function(t){o?o.map(function(e){e&&l[t].classList.remove(e)}):l[t].style.border="0"},s=0;s<l.length;s++)n(s);e.isdown=!1,e.ismove=!1,e.baseX=null,e.baseY=null,e.preX=null,e.preY=null,e.firstX=null,e.firstY=null,e.cloneEl=null,e.sourceEl=null,e.ismovecanput=!1,e.boundaryDetectionHandler&&(cancelAnimationFrame(e.boundaryDetectionHandler),e.boundaryDetectionHandler=null)}function naturalRelease(e,t){var l=this.cloneEl.getBoundingClientRect(),o=l.left,n=l.top,s=e.getBoundingClientRect(),r=o-s.left,c=n-s.top;t.style.position="absolute",t.style.left="".concat(r,"px"),t.style.top="".concat(c,"px"),e.appendChild(t)}function boundaryDetectionScroll(e,t){var l=e.top,o=e.bottom,n=e.left,s=e.right;l&&0!==t.scrollTop&&(t.scrollTop-scrollStep<0?t.scrollTop=0:t.scrollTop-=scrollStep),o&&t.scrollTop!==t.scrollHeight&&(t.scrollTop+scrollStep>t.scrollHeight?t.scrollTop=t.scrollerHeight:t.scrollTop+=scrollStep),n&&0!==t.scrollLeft&&(t.scrollLeft-scrollStep<0?t.scrollLeft=0:t.scrollLeft-=scrollStep),s&&t.scrollLeft!==t.scrollWidth&&(t.scrollLeft+scrollStep>t.scrollWidth?t.scrollLeft=t.scrollWidth:t.scrollLeft+=scrollStep)}var Droppable=function(){function l(e,t){(0,_classCallCheck2.default)(this,l),this.el=e,this.config=Object.assign({},t),this.sourceEls=this.el.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),this.isdown=!1,this.ismove=!1,this.baseX=null,this.baseY=null,this.preX=null,this.preY=null,this.firstX=null,this.firstY=null,this.cloneEl=null,this.sourceEl=null,this.ismovecanput=!1,this.boundaryDetectionHandler=null,initEvents.call(this)}return(0,_createClass2.default)(l,[{key:"refresh",value:function(){for(var e=0;e<this.sourceEls.length;e++){var t=this.sourceEls[e],l=this.sourceEventHanlder.get(t);for(var o in l)t.removeEventListener(o,l[o])}this.sourceEls=this.el.querySelectorAll(".".concat(selectorPrefix,"source")),this.targetEls=this.el.querySelectorAll(".".concat(selectorPrefix,"target")),initDragSourceEvent.call(this)}}]),l}(),DroppableFactory={create:function(e,t){return new Droppable(e,t)}},_default=DroppableFactory;exports.default=_default;
//# sourceMappingURL=droppable.js.map
