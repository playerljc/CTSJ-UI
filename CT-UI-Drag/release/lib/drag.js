"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_uiUtil=require("@ctmobile/ui-util"),selectorPrefix="ct-drag-";function getDragTarget(e){return e.classList.contains("".concat(selectorPrefix,"item"))?e:_uiUtil.Dom6.getTopDom(e,"".concat(selectorPrefix,"item"))}function createCloneEl(e){var t=this,l=t.config.cloneClasses,s=(void 0===l?[]:l).join(" ");t.sourceEl=_uiUtil.Dom6.createElement('<div class="'.concat(selectorPrefix,"clone ").concat(s,'"></div>')),t.sourceEl.style.width="".concat(e.offsetWidth,"px"),t.sourceEl.style.height="".concat(e.offsetHeight,"px");var o=window.getComputedStyle(e);t.sourceEl.style.left=o.left,t.sourceEl.style.top=o.top,t.el.appendChild(t.sourceEl)}function createMapEl(){var e=_uiUtil.Dom6.createElement('<div class="'.concat(selectorPrefix,'map"></div>'));return this.el.appendChild(e),e}function setMapPosition(e){var t=e.left,l=e.top,s=e.width,o=e.height;this.mapEl.innerHTML="\n    <table>\n      <tr>\n        <td>x:".concat(t,"</td>\n        <td>y:").concat(l,"</td>\n      </tr>\n      <tr>\n        <td>w:").concat(s,"</td>\n        <td>h:").concat(o,"</td>\n      </tr>\n    </table>\n  "),this.mapEl.style.left="".concat(t+s+10,"px"),this.mapEl.style.top="".concat(l+(o-this.mapEl.offsetHeight),"px")}function stepDetail(e){var t=e.pageX,l=e.pageY,s=this,o=s.config.moveStep,i=void 0===o?1:o,r=t,n=l,a=Math.abs(r-s.preX),u=Math.abs(n-s.preY),c=Math.floor(a/i)*i,p=Math.floor(u/i)*i;return r=r>s.preX?s.preX+c:s.preX-c,s.preX=r,n=n>s.preY?s.preY+p:s.preY-p,{curX:r,curY:s.preY=n}}function mouseupDetail(){var e=this,t=e.config,l=t.mode,s=void 0===l?"normal":l,o=t.showMap,i=void 0!==o&&o;"clone"===s&&e.srcEl&&e.sourceEl&&(e.srcEl.style.left=e.sourceEl.style.left,e.srcEl.style.top=e.sourceEl.style.top,e.sourceEl.parentElement.removeChild(e.sourceEl)),i&&e.mapEl&&e.mapEl.parentElement.removeChild(e.mapEl)}function initEvents(){var e=this;e.el.addEventListener("mousedown",e.onMousedown),e.el.addEventListener("mouseup",e.onMouseup),e.el.addEventListener("mousemove",e.onMousemove)}function reset(){this.isdown=!1,this.ismove=!1,this.sourceEl=null,this.srcEl=null,this.mouseenterEl=null,this.mapEl=null,this.baseX=null,this.baseY=null,this.firstX=null,this.firstY=null,this.preX=null,this.preY=null}var Drag=function(){function l(e,t){(0,_classCallCheck2.default)(this,l),this.el=e,this.config=Object.assign({},t),this.onMousedown=this.onMousedown.bind(this),this.onMouseup=this.onMouseup.bind(this),this.onMousemove=this.onMousemove.bind(this),this.isdown=!1,this.ismove=!1,this.sourceEl=null,this.srcEl=null,this.mouseenterEl=null,this.baseX=null,this.baseY=null,this.firstX=null,this.firstY=null,this.preX=null,this.preY=null,initEvents.call(this)}return(0,_createClass2.default)(l,[{key:"onMousedown",value:function(e){var t=this,l=getDragTarget(e.target);if(!l)return!1;t.isdown=!0;var s=t.config.mode;"normal"===(void 0===s?"normal":s)?t.sourceEl=l:(t.srcEl=l,createCloneEl.call(t,l));var o=l.getBoundingClientRect(),i=t.el.getBoundingClientRect();t.baseX=o.left-i.left,t.baseY=o.top-i.top,t.firstX=e.pageX,t.firstY=e.pageY,t.preX=e.pageX,t.preY=e.pageY}},{key:"onMouseup",value:function(){mouseupDetail.call(this),reset.call(this)}},{key:"onMousemove",value:function(e){var t=this;if(!t.isdown){var l=getDragTarget(e.target);return l?(t.mouseenterEl=l,t.el.style.cursor="move"):t.mouseenterEl&&(t.el.style.cursor="default",t.mouseenterEl=null),!1}var s=stepDetail.call(t,{pageX:e.pageX,pageY:e.pageY}),o=s.curX,i=s.curY;t.ismove||(t.ismove=!0);var r=t.config.showMap,n=void 0!==r&&r;n&&!t.mapEl&&(t.mapEl=createMapEl.call(t)),t.sourceEl.style.display="block";var a=o-t.firstX,u=i-t.firstY,c=t.baseX+a,p=t.baseY+u;n&&setMapPosition.call(t,{left:c,top:p,width:t.sourceEl.offsetWidth,height:t.sourceEl.offsetHeight}),t.sourceEl.style.left="".concat(c,"px"),t.sourceEl.style.top="".concat(p,"px")}}]),l}(),DragFactory={create:function(e,t){return new Drag(e,t)}},_default=DragFactory;exports.default=_default;
//# sourceMappingURL=drag.js.map
