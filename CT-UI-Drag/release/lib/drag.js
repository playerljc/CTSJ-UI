"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_uiUtil=require("@ctmobile/ui-util"),selectorPrefix="ct-drag-";function getDragTarget(e){return e.classList.contains("".concat(selectorPrefix,"item"))?e:_uiUtil.Dom6.getTopDom(e,"".concat(selectorPrefix,"item"))}function createCloneEl(e){var t=this,l=t.config.cloneClasses,s=(void 0===l?[]:l).join(" ");t.sourceEl=_uiUtil.Dom6.createElement('<div class="'.concat(selectorPrefix,"clone ").concat(s,'"></div>')),t.sourceEl.style.width="".concat(e.offsetWidth,"px"),t.sourceEl.style.height="".concat(e.offsetHeight,"px");var i=window.getComputedStyle(e);t.sourceEl.style.left=i.left,t.sourceEl.style.top=i.top,t.el.appendChild(t.sourceEl)}function createMapEl(){var e=_uiUtil.Dom6.createElement('<div class="'.concat(selectorPrefix,'map"></div>'));return this.el.appendChild(e),e}function setMapPosition(e){var t=e.left,l=e.top,s=e.width,i=e.height;this.mapEl.innerHTML="\n    <table>\n      <tr>\n        <td>x:".concat(t,"</td>\n        <td>y:").concat(l,"</td>\n      </tr>\n      <tr>\n        <td>w:").concat(s,"</td>\n        <td>h:").concat(i,"</td>\n      </tr>\n    </table>\n  "),this.mapEl.style.left="".concat(t+s+10,"px"),this.mapEl.style.top="".concat(l+(i-this.mapEl.offsetHeight),"px")}function stepDetail(e){var t=e.pageX,l=e.pageY,s=this,i=s.config.moveStep,o=void 0===i?1:i,r=t,n=l,a=Math.abs(r-s.preX),u=Math.abs(n-s.preY),c=Math.floor(a/o)*o,p=Math.floor(u/o)*o;return r=r>s.preX?s.preX+c:s.preX-c,s.preX=r,n=n>s.preY?s.preY+p:s.preY-p,{curX:r,curY:s.preY=n}}function mouseupDetail(){var e=this,t=e.config,l=t.mode,s=void 0===l?"normal":l,i=t.showMap,o=void 0!==i&&i;"clone"===s&&e.srcEl&&e.sourceEl&&(e.srcEl.style.left=e.sourceEl.style.left,e.srcEl.style.top=e.sourceEl.style.top,e.sourceEl.parentElement.removeChild(e.sourceEl)),o&&e.mapEl&&e.mapEl.parentElement.removeChild(e.mapEl)}function initEvents(){var e=this;e.el.addEventListener("mousedown",e.onMousedown),e.el.addEventListener("mouseup",e.onMouseup),e.el.addEventListener("mousemove",e.onMousemove)}function reset(){this.isdown=!1,this.ismove=!1,this.sourceEl=null,this.srcEl=null,this.mouseenterEl=null,this.mapEl=null,this.baseX=null,this.baseY=null,this.firstX=null,this.firstY=null,this.preX=null,this.preY=null}var Drag=function(){function l(e,t){(0,_classCallCheck2.default)(this,l),this.el=e,this.config=Object.assign({},t),this.disable=!1,this.onMousedown=this.onMousedown.bind(this),this.onMouseup=this.onMouseup.bind(this),this.onMousemove=this.onMousemove.bind(this),this.isdown=!1,this.ismove=!1,this.sourceEl=null,this.srcEl=null,this.mouseenterEl=null,this.baseX=null,this.baseY=null,this.firstX=null,this.firstY=null,this.preX=null,this.preY=null,initEvents.call(this)}return(0,_createClass2.default)(l,[{key:"onMousedown",value:function(e){var t=this,l=t.disable;if(void 0!==l&&l)return!1;var s=getDragTarget(e.target);if(!s)return!1;t.isdown=!0;var i=t.config.mode;"normal"===(void 0===i?"normal":i)?t.sourceEl=s:(t.srcEl=s,createCloneEl.call(t,s));var o=s.getBoundingClientRect(),r=t.el.getBoundingClientRect();t.baseX=o.left-r.left,t.baseY=o.top-r.top,t.firstX=e.pageX,t.firstY=e.pageY,t.preX=e.pageX,t.preY=e.pageY}},{key:"onMouseup",value:function(){var e=this,t=e.disable;if(void 0!==t&&t)return!1;mouseupDetail.call(e),reset.call(e)}},{key:"onMousemove",value:function(e){var t=this,l=t.disable;if(void 0!==l&&l)return!1;if(!t.isdown){var s=getDragTarget(e.target);return s?(t.mouseenterEl=s,t.el.style.cursor="move"):t.mouseenterEl&&(t.el.style.cursor="default",t.mouseenterEl=null),!1}var i=stepDetail.call(t,{pageX:e.pageX,pageY:e.pageY}),o=i.curX,r=i.curY;t.ismove||(t.ismove=!0);var n=t.config.showMap,a=void 0!==n&&n;a&&!t.mapEl&&(t.mapEl=createMapEl.call(t)),t.sourceEl.style.display="block";var u=o-t.firstX,c=r-t.firstY,p=t.baseX+u,h=t.baseY+c;a&&setMapPosition.call(t,{left:p,top:h,width:t.sourceEl.offsetWidth,height:t.sourceEl.offsetHeight}),t.sourceEl.style.left="".concat(p,"px"),t.sourceEl.style.top="".concat(h,"px")}},{key:"setDisable",value:function(e){this.disable=e}}]),l}(),DragFactory={create:function(e,t){return new Drag(e,t)}},_default=DragFactory;exports.default=_default;
//# sourceMappingURL=drag.js.map
