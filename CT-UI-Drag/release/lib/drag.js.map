{"version":3,"sources":["drag.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","_classCallCheck2","_createClass2","_uiUtil","selectorPrefix","getDragTarget","el","classList","contains","concat","Dom6","getTopDom","createCloneEl","sourceEl","self","this","_self$config$cloneCla","config","cloneClasses","cloneClassNames","join","createElement","style","width","offsetWidth","height","offsetHeight","computedStyle","window","getComputedStyle","left","top","appendChild","createMapEl","mapEl","setMapPosition","_ref","innerHTML","stepDetail","_ref2","pageX","pageY","_self$config$moveStep","moveStep","step","curX","curY","displacementX","Math","abs","preX","displacementY","preY","distanceX","floor","distanceY","mouseupDetail","_self$config","_self$config$mode","mode","_self$config$showMap","showMap","srcEl","parentElement","removeChild","initEvents","addEventListener","onMousedown","onMouseup","onMousemove","reset","isdown","ismove","mouseenterEl","baseX","baseY","firstX","firstY","Drag","assign","bind","call","key","e","target","_self$config$mode2","sourceElRect","getBoundingClientRect","containerElReact","cursor","curPoint","_self$config$showMap2","display","incrementX","incrementY","DragFactory","create","_default"],"mappings":"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","file":"drag.js","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _uiUtil = require(\"@ctmobile/ui-util\");\n\n/**\r\n\r\n 配置:\r\n el\r\n {\r\n  mode: [normal(正常模式) | clone(克隆模式)]\r\n  cloneClasses: mode为clone时移动节点的样式\r\n  showMap: [Boolean] 是否显示地图\r\n  moveStep: [number] 移动的步进 默认值1\r\n  showGuide: [Boolean] 是否显示辅助线 (没实现)\r\n  showStaff: [Boolean] 是否显示标尺 (没实现)\r\n }\r\n\r\n 布局:\r\n <div class=\"ct-drag\">\r\n <div class=\"ct-drag-item\"></div>\r\n </div>\r\n\r\n 功能:\r\n .拖拽移动一个元素\r\n .正常拖拽\r\n .clone的拖拽\r\n .拖拽中地图的显示\r\n .辅助线\r\n .触发的事件\r\n\r\n 测试:\r\n\r\n log:\r\n\r\n demo:\r\n\r\n */\nvar selectorPrefix = 'ct-drag-'; // const Dom6 = {\n//   getTopDom(target, selector) {\n//     if (!target || !selector) return null;\n//\n//     if (target.className.indexOf(selector) !== -1) {\n//       return target;\n//     }\n//\n//     let parentDom = target;\n//     while ((parentDom = parentDom.parentNode)) {\n//       if (parentDom.className.indexOf(selector) !== -1) {\n//         break;\n//       } else if (parentDom === document.body) break;\n//     }\n//\n//     if (parentDom) {\n//       if (parentDom === document.body) {\n//         return null;\n//       } else {\n//         return parentDom;\n//       }\n//     } else {\n//       return null;\n//     }\n//   },\n//\n//   createElement(html) {\n//     const dom = document.createElement('div');\n//     dom.innerHTML = html;\n//     return dom.firstElementChild;\n//   },\n// };\n\n/**\r\n * getDragTarget\r\n * @param {HTMLElement} - el\r\n * @return {HTMLElement}\r\n */\n\nfunction getDragTarget(el) {\n  if (el.classList.contains(\"\".concat(selectorPrefix, \"item\"))) {\n    return el;\n  }\n\n  var targetEl = _uiUtil.Dom6.getTopDom(el, \"\".concat(selectorPrefix, \"item\"));\n\n  return targetEl;\n}\n/**\r\n * createCloneEl\r\n * @param {HTMLElement} - sourceEl\r\n * @access private\r\n */\n\n\nfunction createCloneEl(sourceEl) {\n  var self = this;\n  var _self$config$cloneCla = self.config.cloneClasses,\n      cloneClasses = _self$config$cloneCla === void 0 ? [] : _self$config$cloneCla;\n  var cloneClassNames = cloneClasses.join(' ');\n  self.sourceEl = _uiUtil.Dom6.createElement(\"<div class=\\\"\".concat(selectorPrefix, \"clone \").concat(cloneClassNames, \"\\\"></div>\"));\n  self.sourceEl.style.width = \"\".concat(sourceEl.offsetWidth, \"px\");\n  self.sourceEl.style.height = \"\".concat(sourceEl.offsetHeight, \"px\");\n  var computedStyle = window.getComputedStyle(sourceEl);\n  self.sourceEl.style.left = computedStyle.left;\n  self.sourceEl.style.top = computedStyle.top;\n  self.el.appendChild(self.sourceEl);\n}\n/**\r\n * createMapEl\r\n * @access private\r\n * @return {HTMLElement}\r\n */\n\n\nfunction createMapEl() {\n  var mapEl = _uiUtil.Dom6.createElement(\"<div class=\\\"\".concat(selectorPrefix, \"map\\\"></div>\"));\n\n  this.el.appendChild(mapEl);\n  return mapEl;\n}\n/**\r\n * setMapPosition\r\n * @param {number} - left\r\n * @param {number} - top\r\n * @param {number} - width\r\n * @param {number} - height\r\n */\n\n\nfunction setMapPosition(_ref) {\n  var left = _ref.left,\n      top = _ref.top,\n      width = _ref.width,\n      height = _ref.height;\n  this.mapEl.innerHTML = \"\\n    <table>\\n      <tr>\\n        <td>x:\".concat(left, \"</td>\\n        <td>y:\").concat(top, \"</td>\\n      </tr>\\n      <tr>\\n        <td>w:\").concat(width, \"</td>\\n        <td>h:\").concat(height, \"</td>\\n      </tr>\\n    </table>\\n  \");\n  this.mapEl.style.left = \"\".concat(left + width + 10, \"px\");\n  this.mapEl.style.top = \"\".concat(top + (height - this.mapEl.offsetHeight), \"px\");\n}\n/**\r\n * stepDetail\r\n * @param {Number} - pageX\r\n * @param {Number} - pageY\r\n * @return {Object}\r\n * @access private\r\n */\n\n\nfunction stepDetail(_ref2) {\n  var pageX = _ref2.pageX,\n      pageY = _ref2.pageY;\n  var self = this;\n  var _self$config$moveStep = self.config.moveStep,\n      step = _self$config$moveStep === void 0 ? 1 : _self$config$moveStep;\n  var curX = pageX;\n  var curY = pageY; // 位移\n\n  var displacementX = Math.abs(curX - self.preX);\n  var displacementY = Math.abs(curY - self.preY); // x,y段\n\n  var segmentX = Math.floor(displacementX / step);\n  var segmentY = Math.floor(displacementY / step); // 距离\n\n  var distanceX = segmentX * step;\n  var distanceY = segmentY * step; // X方向\n\n  if (curX > self.preX) {\n    // ->\n    curX = self.preX + distanceX;\n  } else {\n    // <-\n    curX = self.preX - distanceX;\n  }\n\n  self.preX = curX; // Y方向\n\n  if (curY > self.preY) {\n    // ->\n    curY = self.preY + distanceY;\n  } else {\n    // <-\n    curY = self.preY - distanceY;\n  }\n\n  self.preY = curY;\n  return {\n    curX: curX,\n    curY: curY\n  };\n}\n/**\r\n * mouseupDetail\r\n * @access private\r\n */\n\n\nfunction mouseupDetail() {\n  var self = this;\n  var _self$config = self.config,\n      _self$config$mode = _self$config.mode,\n      mode = _self$config$mode === void 0 ? 'normal' : _self$config$mode,\n      _self$config$showMap = _self$config.showMap,\n      showMap = _self$config$showMap === void 0 ? false : _self$config$showMap; // 如果model是clone时\n\n  if (mode === 'clone' && self.srcEl && self.sourceEl) {\n    self.srcEl.style.left = self.sourceEl.style.left;\n    self.srcEl.style.top = self.sourceEl.style.top;\n    self.sourceEl.parentElement.removeChild(self.sourceEl);\n  }\n\n  if (showMap && self.mapEl) {\n    self.mapEl.parentElement.removeChild(self.mapEl);\n  }\n}\n/**\r\n * initEvents\r\n * @access private\r\n */\n\n\nfunction initEvents() {\n  var self = this;\n  self.el.addEventListener('mousedown', self.onMousedown);\n  self.el.addEventListener('mouseup', self.onMouseup);\n  self.el.addEventListener('mousemove', self.onMousemove);\n}\n/**\r\n * reset\r\n * @access private\r\n */\n\n\nfunction reset() {\n  this.isdown = false; // 是否按下了\n\n  this.ismove = false; // 是否move了\n\n  this.sourceEl = null;\n  this.srcEl = null;\n  this.mouseenterEl = null;\n  this.mapEl = null;\n  this.baseX = null;\n  this.baseY = null;\n  this.firstX = null;\n  this.firstY = null;\n  this.preX = null;\n  this.preY = null;\n}\n/**\r\n * Drag\r\n * @class Drag\r\n * @classdesc Drag\r\n */\n\n\nvar Drag =\n/*#__PURE__*/\nfunction () {\n  /**\r\n   * constructor\r\n   * @constructor\r\n   * @param {HTMLElement} - el\r\n   * @param {Object} - config\r\n   */\n  function Drag(el, config) {\n    (0, _classCallCheck2[\"default\"])(this, Drag);\n    this.el = el;\n    this.config = Object.assign({}, config);\n    this.onMousedown = this.onMousedown.bind(this);\n    this.onMouseup = this.onMouseup.bind(this);\n    this.onMousemove = this.onMousemove.bind(this);\n    this.isdown = false; // 是否按下了\n\n    this.ismove = false; // 是否move了\n\n    this.sourceEl = null;\n    this.srcEl = null;\n    this.mouseenterEl = null;\n    this.baseX = null;\n    this.baseY = null;\n    this.firstX = null;\n    this.firstY = null;\n    this.preX = null;\n    this.preY = null;\n    initEvents.call(this);\n  }\n  /**\r\n   * onMousedown\r\n   */\n\n\n  (0, _createClass2[\"default\"])(Drag, [{\n    key: \"onMousedown\",\n    value: function onMousedown(e) {\n      var self = this;\n      var sourceEl = getDragTarget(e.target);\n      if (!sourceEl) return false;\n      self.isdown = true;\n      var _self$config$mode2 = self.config.mode,\n          mode = _self$config$mode2 === void 0 ? 'normal' : _self$config$mode2;\n\n      if (mode === 'normal') {\n        self.sourceEl = sourceEl;\n      } else {\n        // mode === 'clone'\n        self.srcEl = sourceEl; // create clone element\n\n        createCloneEl.call(self, sourceEl);\n      } // 在parent里移动\n\n\n      var sourceElRect = sourceEl.getBoundingClientRect();\n      var containerElReact = self.el.getBoundingClientRect();\n      self.baseX = sourceElRect.left - containerElReact.left;\n      self.baseY = sourceElRect.top - containerElReact.top;\n      self.firstX = e.pageX;\n      self.firstY = e.pageY;\n      self.preX = e.pageX;\n      self.preY = e.pageY;\n    }\n    /**\r\n     * onMouseup\r\n     */\n\n  }, {\n    key: \"onMouseup\",\n    value: function onMouseup() {\n      var self = this;\n      mouseupDetail.call(self);\n      reset.call(self);\n    }\n    /**\r\n     * onMousemove\r\n     */\n\n  }, {\n    key: \"onMousemove\",\n    value: function onMousemove(e) {\n      var self = this;\n\n      if (!self.isdown) {\n        var sourceEl = getDragTarget(e.target);\n\n        if (sourceEl) {\n          self.mouseenterEl = sourceEl;\n          self.el.style.cursor = 'move';\n        } else if (self.mouseenterEl) {\n          self.el.style.cursor = 'default';\n          self.mouseenterEl = null;\n        }\n\n        return false;\n      }\n\n      var curPoint = stepDetail.call(self, {\n        pageX: e.pageX,\n        pageY: e.pageY\n      });\n      var curX = curPoint.curX,\n          curY = curPoint.curY;\n\n      if (!self.ismove) {\n        self.ismove = true;\n      }\n\n      var _self$config$showMap2 = self.config.showMap,\n          showMap = _self$config$showMap2 === void 0 ? false : _self$config$showMap2;\n\n      if (showMap && !self.mapEl) {\n        self.mapEl = createMapEl.call(self);\n      }\n\n      self.sourceEl.style.display = 'block';\n      var incrementX = curX - self.firstX;\n      var incrementY = curY - self.firstY;\n      var left = self.baseX + incrementX;\n      var top = self.baseY + incrementY;\n\n      if (showMap) {\n        setMapPosition.call(self, {\n          left: left,\n          top: top,\n          width: self.sourceEl.offsetWidth,\n          height: self.sourceEl.offsetHeight\n        });\n      }\n\n      self.sourceEl.style.left = \"\".concat(left, \"px\");\n      self.sourceEl.style.top = \"\".concat(top, \"px\");\n    }\n  }]);\n  return Drag;\n}();\n/**\r\n * DragFactory\r\n */\n\n\nvar DragFactory = {\n  /**\r\n   * 创建一个Drag\r\n   * @param {HtmlElement} - el\r\n   * @param {Object} - config\r\n   * @return {Drag} - Drag\r\n   */\n  create: function create(el, config) {\n    return new Drag(el, config);\n  }\n};\nvar _default = DragFactory;\nexports[\"default\"] = _default;"]}